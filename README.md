# jrun

A shell script which calculates out desired java options for a given
environment and executes the jar.

This allows having a system like ansible, puppet, or chef generate
host-specific overrides for java options while allowing "standard"
options to be installed with a package.

## Usage:

```bash
./jrun.sh [-l {_log-file.log_}] [-c {_directory_}]* [-j {_jar-file_}]* [{_jar-parameter_}]*
```

## Options:

* *-l | --log {_log-file.log_}* log intermediate output to the
specified {_log-file.log_}. If no {_log-file_} is specified,
intermediate output is logged to stderr. jrun is fairly verbose, to
aid debugging your config files.

* *-c | --config-dir {_directory_}* scan {_directory_} for files
matching the glob pattern ```*.jrun.sh``` and source each file found.

* *-j {_jar-file_}* jrun will use the specified {_jar-file_} as
the .jar which it passes to java.

* *{_jar-parameter_}* additional command line options to pass after the {_jar-file_}

## Examples

The fact that jrun sources _-c_ directories in the order they are
specified is the basis for how you can set up environment- or even
host-specific overrides. Provide a directory with your .jar for the
defaults, and on a given host, provide an additional directory with
your overrides.

For example, if your .jar is installed to _/path/app/foo.jar_, and
your jar's defaults are in _/path/app/jrun.d/_, you could have overrides
in _/etc/default/app.jrun/_, and use jrun like this:

```bash
./jrun.sh -c /path/app/jrun.d/ -c /etc/default/app.jrun/ -j /path/app/foo.jar server
```

## *.jrun.sh

You may be wondering at this point what you should put in your
*.jrun.sh files, which will reside in your ```-c {directory}```
locations. What you will want to do is have a series of bash exports,
following the convention ```JAVA_OPT_{name}={setting}```.

For example:

```bash
#!/bin/bash

# set initial size of heap to 6MB.
export JAVA_OPT_Xms=-Xms6m
```

Note that we leave the value "6m" off of the variable name. This is so
that the next _*.jrun.sh_ file can replace this value by doing something like:

```bash
#!/bin/bash

# set initial size of heap to 24MB
export JAVA_OPT_Xms=-Xms24m
```

Since _*.jrun.sh_ files are just shell scripts, you could
theoretically include complex calculations, run programs, etc, to
figure out what a particular ```JAVA_OPT_{name}``` ought to be set to,
but that will likely be overkill. You probably actually just want to
have a few directories for jrun.sh to look in:

* A directory which comes with your .jar file

* A directory which is generated by your host management system (e.g.,
ansible, puppet, or chef)

* A directory inside your user account (e.g., ~/.etc/app.jrun/) so
that you can override the environment-specific overrides.

## Building Packages

1. install fpm
2. install gnu-make
3. run make
